image: ruby:2.5

variables:
  JEKYLL_ENV: production

build_4c-multiphysics.org:
  stage: test
  script:
  - bundle config set --local path 'vendor/bundle'
  - bundle install
  - bundle exec jekyll build -d website
  - cp .htaccess website/
  artifacts:
    paths:
    - website/
  
publish_4c-multiphysics.org:
  stage: deploy
  needs:
  - job: build_4c-multiphysics.org
    artifacts: true
  rules:
    - if: $CI_COMMIT_BRANCH == $CI_DEFAULT_BRANCH
  script:
  - rsync -rpt -e ssh --delete website/ di35non@webdev02-mwn.lrz.de:/nfs/web_tum/www/n/di35non/webserver/htdocs
  

pages:
  stage: deploy
  needs:
  - job: build_4c-multiphysics.org
    artifacts: true
  script:
  - rm -rf public
  - mkdir public
  - mv gitlab_pages_redirect.html public/index.html
  artifacts:
    paths:
    - public
  rules:
    - if: $CI_COMMIT_BRANCH == $CI_DEFAULT_BRANCH
